江南大学实验室设备管理系统（LESMS）
软件需求规格说明书（SRS）

0. 文档控制信息
- 文档名称：江南大学实验室设备管理系统（LESMS）软件需求规格说明书（SRS）
- 版本：V1.1（根据评估意见补齐关键遗漏与规则细化）
- 系统命名：江南大学实验室设备管理系统（LESMS）
- 依据来源：need.txt、课程指导书PDF、yonglitu.txt、analysis.txt

1. 引言
1.1 目的
本SRS用于定义LESMS的业务目标、范围边界与可验证需求，作为后续用例图/用例规约/活动图、BCE分析类图、设计类图、时序图与物理ERD的唯一依据。

1.2 系统范围
系统支持：设备信息维护与台账管理、设备可用性查询、预约申请与维护、审批流转、校外缴费确认、统计报表生成、单据/报表打印导出。

1.3 术语与缩写
- LESMS：Laboratory Equipment Service Management System
- 负责人：实验室负责人（LabHead）
- 管理员：设备管理员（EquipmentAdmin）
- 借用人员：Borrower（校内教师、校内学生、校外人员）
- 指导教师：Advisor（对学生申请进行审批的教师角色分支）
- 财务系统：FinanceSystem（学校财务处系统）

2. 总体描述
2.1 用户类别
- 实验室负责人（LabHead）：可审批校外借用、查看统计报表、管理制度与监督。
- 设备管理员（EquipmentAdmin）：设备维护、台账维护、审批校内借用、校外借用初审/最终确认、借用资格核验。
- 借用人员（Borrower）：注册、维护个人信息、查询设备可用性、提交/修改/撤销预约申请。
  - 校内教师（TeacherBorrower）
  - 校内学生（StudentBorrower）
  - 校外人员（ExternalBorrower）
- 外部系统：学校财务处系统（FinanceSystem）
- 外部设备：打印机（Printer）
- 系统时钟/定时器（Timer）：触发周报/月报/年报自动生成任务

2.2 运行环境与约束（概述）
- 借用人员通过Internet访问；工作人员（负责人/管理员）仅在局域网内访问。
- 系统需支持单据/报表导出与打印。
- 校外收费流程需对接财务系统确认。

3. 功能性需求（Functional Requirements）
3.1 用户注册、登录与个人信息
FR-1 用户注册：借用人员（教师/学生/校外）可通过系统注册账号，并允许维护个人信息。
FR-2 登录与鉴权：系统应支持登录与角色鉴权（负责人、管理员、借用人员-教师/学生/校外）。
FR-3 个人资料维护：注册用户可维护个人资料（姓名、联系方式、所属单位/学院等），并可查看自身申请/预约信息。

3.2 设备信息与台账维护
FR-4 设备台账维护：管理员可录入、修改、查询设备台账信息（设备编号、型号、购入时间、厂商、用途、时段可用状态、租用价格等）。
FR-5 人员台账维护：系统应维护教师台账、学生台账、校外人员台账（字段见数据定义）。
FR-6 预约台账维护：系统应维护预约台账：设备信息、借用人员信息、借用时段、预约审批相关信息。

3.3 设备可用性与检修时间窗
FR-7 可用性查询：用户可查询设备在指定日期/时段的可用性。
FR-8 检修时间窗维护：管理员应能维护设备检修时间窗；检修时段设备不可被预约。

3.4 预约申请、修改与撤销
FR-9 提交预约申请：借用人员可提交设备预约/借用申请（选择设备、时间段、用途说明等）。
FR-10 修改预约申请：在“未审批/被退回补充材料”状态下，申请人可修改并重新提交。
FR-11 撤销预约申请：申请人在“未审批”状态下可撤销申请。
FR-12 撤销已批准预约：借用人员可对“已批准”的预约进行撤销操作，必须满足“至少提前1天以上”的规则。

3.5 预约冲突处理与校内优先
FR-13 冲突检测：系统应检测同设备同时间段的预约冲突，并阻止自动通过冲突预约。
FR-14 校内优先提示/支持：发生资源冲突时，系统应保障“校内人员优先”的规则落地（见业务规则BRULE-5），在审批界面向审批人提示优先级，并支持审批人优先通过校内申请。

3.6 审批流程（差异化审批链）
FR-15 校内教师审批：校内教师的预约申请需由设备管理员审批。
FR-16 校内学生审批：校内学生的预约申请需先经其指导教师审批，再由设备管理员审批。
FR-17 校外人员审批：校外人员预约申请需先由设备管理员审批，再由实验室负责人审批；审批通过后进入缴费确认与管理员最终确认流程。
FR-18 审批操作：审批人可对待办申请执行“通过/驳回/退回补充材料”，并填写审批意见。
FR-19 审批留痕：系统必须记录每次审批的审批人、时间、决策、意见，形成审批轨迹。

3.7 校外缴费、盖章与财务对接
FR-20 缴费触发：校外预约审批通过后，系统生成缴费指引/缴费单号（或订单）。
FR-21 财务系统确认：系统应通过财务处系统接口查询/接收缴费确认结果，并将“支付成功/失败/待确认”状态同步至预约记录。
FR-22 纸质盖章凭证（可选但建议保留）：若流程要求“缴费后盖章”，系统应支持在申请单上标注缴费确认信息（或由线下盖章后上传凭证）。
FR-23 管理员最终确认：缴费确认成功后，设备管理员必须执行最终确认操作，方可将预约状态置为“可借出/已生效”。
FR-24 退款处理：撤销付费预约时，系统应根据退款规则自动计算退款金额并生成退款记录（见BRULE-6）。

3.8 借出、归还与状态管理
FR-25 借出登记：管理员可基于已生效预约登记借出，记录借出时间与交接信息。
FR-26 归还登记：管理员可登记归还，记录归还时间与设备状态（正常/损坏/待检修）。
FR-27 状态更新：系统应根据借出/归还/检修维护自动更新设备可用状态。

3.9 导师维护学生名单（含Excel导入）
FR-28 学生名单维护：教师用户可维护其指导的学生列表（新增/删除/查询）。
FR-29 Excel批量导入：教师用户可通过上传Excel表格批量导入/更新其指导学生名单，系统应校验格式并提示导入结果。
FR-30 关系校验支撑：学生提交预约申请时，系统需支持管理员核验该学生与指导教师关系有效性（基于学生台账/导师学生列表）。

3.10 统计报表（周报/月报/年报）
FR-31 报表生成：系统应生成实验设备使用情况周报、月报、年报。
FR-32 报表自动生成：系统应通过定时器按周期自动生成周报/月报/年报（见BRULE-8），并可手动补生成。
FR-33 报表查询与导出：负责人/管理员可查询历史报表，报表可导出（如PDF/Excel）并支持打印。

3.11 打印与通知
FR-34 单据打印/导出：系统支持申请单、审批单、交接单等的打印或导出后打印。
FR-35 通知提醒：系统支持在关键节点通知（提交申请、审批结果、缴费确认、撤销/退款、超期提醒、报表生成等）。

4. 非功能性需求（Non-Functional Requirements）
NFR-1 可用性：常用操作流程清晰，表单校验与错误提示明确。
NFR-2 性能：在100M以上宽带网络条件下，常规交互（列表/查询/提交/审批等）响应时间≤2秒；1年范围内复杂查询/统计响应时间≤20秒；系统应支持同时在线用户数≥1000。
NFR-3 安全性：登录鉴权、权限控制、关键操作留痕；敏感信息受保护。
NFR-4 可靠性：设备/人员/预约/审批/缴费/借还等关键数据必须持久化保存，并保证连续3年以上时间数据安全不能丢失（可通过备份/恢复策略实现）。
NFR-5 可审计性：申请、审批、缴费确认、管理员最终确认、借还、退款等过程可追溯。
NFR-6 访问限制（局域网）：工作人员侧功能（审批、台账维护、管理员最终确认等）应部署在或限制访问来源为局域网；借用人员查询与提交申请可通过Internet访问。
NFR-7 数据规模：系统应支持设备数量≥20000台套、注册用户数量≥5000，且设备每年新增≥200台套；单日可接纳实验人数≥1000（规模假设）。
NFR-8 平台兼容：客户端支持PC端Windows系统；服务端支持Linux系统。
NFR-9 打印兼容：系统应支持任意打印机打印单据或报表（可通过导出PDF/通用打印方式实现）。

5. 业务规则（Business Rules）
BRULE-1 用户类型与策略：借用人员分为校内教师、校内学生、校外人员，不同类型对应不同审批链与收费策略。
BRULE-2 时间冲突：同一设备同一时间段不可被多条预约占用；检修时间窗不可预约。
BRULE-3 撤销规则：已批准预约可撤销，但必须至少提前1天以上。
BRULE-4 校外先缴费后确认：校外预约审批通过后必须完成缴费确认，才能进入管理员最终确认与借出环节。
BRULE-5 校内优先：资源冲突时应保障校内人员优先。实现方式可采用“校内更早开放预约提前期/审批界面提示优先级/管理员优先通过校内申请”等策略，至少在审批环节明确提示并体现优先处理。
BRULE-6 退款规则：付费预约撤销时仅退还原费用的95%，系统自动计算并生成退款记录。
BRULE-7 审批留痕：任何审批操作必须记录审批人、时间、意见、结果。
BRULE-8 报表周期：周报/月报/年报按固定周期由定时器触发自动生成。
BRULE-9 收费策略：校内人员借用免费；校外人员只能付费借用（按设备租用价格计算），并遵循“先缴费后确认”（见BRULE-4）。
BRULE-10 借用时段粒度：借用/预约时间段的最小单位为2小时（即2学时）；系统在提交与修改预约时进行步长与边界校验。
BRULE-11 预约提前期：设备借用必须提前1-7天预约；系统在提交与修改预约时校验申请日期与借用日期的间隔。
BRULE-12 可借用时段：除设备检修时间窗外，每周7天每天24小时均可预约/借用设备。

6. 数据定义（Data Definitions）
DD-1 设备台账（DeviceLedger）
- deviceNo: 设备编号（唯一）
- model: 型号
- purchaseDate: 购入时间
- manufacturer: 生产厂商
- purpose: 实验用途
- availabilityStatus: 可用状态（可用/预约中/借出/检修）
- rentPrice: 租用价格（校外计费）
- maintenanceWindows: 检修时间窗集合

DD-2 教师台账（TeacherLedger）
- teacherNo: 教师编号（唯一）
- name: 姓名
- gender: 性别
- title: 职称
- direction: 专业方向
- college: 学院
- advisedStudentList: 指导学生列表（studentNo集合）

DD-3 学生台账（StudentLedger）
- studentNo: 学号（唯一）
- name: 姓名
- gender: 性别
- major: 专业
- advisorTeacherNo: 导师编号
- college: 学院

DD-4 校外人员台账（ExternalUserLedger）
- externalNo: 校外编号（唯一）
- name: 姓名
- gender: 性别
- orgName: 单位名称
- contact: 联系方式

DD-5 预约台账（ReservationLedger）
- reservationId: 预约编号（唯一）
- deviceNo: 设备编号
- borrowerType: 借用人员类型（教师/学生/校外）
- borrowerId: 借用人员编号（teacherNo/studentNo/externalNo）
- timeSlot: 借用时段（startTime, endTime）
- status: 状态（草稿/已提交/待审批/退回补充/已批准/已驳回/待缴费确认/待最终确认/已生效/已撤销/已借出/已归还）
- approvalTrail: 审批轨迹（多条）
- paymentStatus: 支付状态（不适用/待确认/成功/失败）
- refundRecord: 退款记录（可选）

7. 业务流程与状态概述（简述）
- 预约提交 -> 冲突检测 -> 按用户类型进入审批链 ->（校外）缴费确认 -> 管理员最终确认 -> 生效 -> 借出 -> 归还/检修
- 已批准预约可撤销（至少提前1天），校外撤销触发95%退款记录

8. 接口需求（Interface Requirements）
8.1 用户界面（UI）概述
- 登录/注册页、个人信息维护页
- 设备查询列表页、设备详情页
- 预约提交页、我的预约（查看/修改/撤销）页
- 审批待办页（教师审批、负责人审批）
- 缴费状态页/缴费指引页（校外）
- 管理员最终确认页（校外）
- 设备台账维护页、人员台账维护页
- 报表页（周报/月报/年报）、导出/打印入口

8.2 外部接口
IR-EXT-1 财务处系统接口：查询/接收缴费确认结果，回传/同步支付状态（成功/失败/待确认），支持退款记录对接（如课程允许可仅记录待处理）。
IR-EXT-2 打印机接口：单据/报表打印（可实现为导出PDF后打印）。
IR-EXT-3 定时器/系统时钟：触发周报/月报/年报自动生成任务。
