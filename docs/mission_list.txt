LESMS 开发任务清单
Web 架构（后端 REST API + 前端管理台/用户端）
- 后端：FastAPI，需实现 RBAC、工作流状态机、定时任务、导出
- DB：建议 PostgreSQL/MySQL（需要迁移脚本）
- 前端：建议 Vue3（至少能完成核心流程的页面）
- 部署：支持 Linux和windows server；本地可一键启动（Docker Compose 优先）
一、工程初始化与基础设施
[x] T01 初始化代码仓库：backend / frontend / db-migrations / docs 目录与README
[x] T02 环境配置：.env.example（DB/JWT/FinanceMock/Cron等）+ 配置加载模块
[x] T03 数据库连接与迁移框架：支持一键 init / migrate / rollback
[x] T04 统一错误码与返回格式：错误提示可读、表单校验友好（NFR-1）

二、鉴权与账号体系（FR-1~FR-3）
[x] T05 用户注册：支持教师/学生/校外三类借用人员注册（FR-1）
[x] T06 登录与角色鉴权：负责人/管理员/借用人员（含子类型）RBAC（FR-2）
[ ] T07 个人资料维护：姓名、联系方式、学院/单位等；“我的预约”入口（FR-3）
[ ] T08 安全加固：密码哈希、登录保护、敏感字段脱敏（NFR-3）

三、台账管理（FR-4~FR-6）
[ ] T09 设备台账 CRUD：deviceNo唯一、型号、购入时间、厂商、用途、租用价格、状态（FR-4）
[ ] T10 人员台账 CRUD：教师台账、学生台账、校外人员台账（FR-5）
[ ] T11 预约台账结构落库：预约记录含设备/人员/时段/审批/支付/状态字段（FR-6）

四、可用性与检修窗（FR-7~FR-8）
[ ] T12 设备可用性查询接口：按日期/时段返回可用/占用（FR-7）
[ ] T13 检修时间窗 CRUD：维护检修窗；检修窗内不可预约（FR-8）

五、预约申请/修改/撤销（FR-9~FR-12 + BRULE-10/11）
[ ] T14 预约提交：选择设备、时间段、用途说明（FR-9）
[ ] T15 时间规则校验：最小2小时粒度；必须提前1-7天；7*24可借（BRULE-10/11/12）
[ ] T16 预约修改：仅“未审批/退回补充材料”可改并重提（FR-10）
[ ] T17 预约撤销（未审批）：申请人可撤销（FR-11）
[ ] T18 预约撤销（已批准）：必须至少提前1天（FR-12 + BRULE-3）

六、冲突处理与校内优先（FR-13~FR-14 + BRULE-2/5）
[ ] T19 冲突检测：同设备同时间段不可重叠；阻止自动通过（FR-13）
[ ] T20 并发保护：事务/锁/唯一约束，确保不会“双占用”（BRULE-2）
[ ] T21 校内优先落地：审批待办/冲突提示中显式标注优先级，支持审批人优先通过校内（FR-14）

七、差异化审批链与留痕（FR-15~FR-19 + BRULE-1/7）
[ ] T22 审批工作流引擎：按 borrowerType 生成审批链与状态机（BRULE-1）
[ ] T23 教师申请审批：管理员审批（FR-15）
[ ] T24 学生申请审批：导师审批 → 管理员审批（FR-16）
[ ] T25 校外申请审批：管理员初审 → 负责人审批（FR-17）
[ ] T26 审批操作：通过/驳回/退回补充材料 + 审批意见（FR-18）
[ ] T27 审批留痕：审批人/时间/意见/决策全记录，可查询轨迹（FR-19 + BRULE-7）

八、校外缴费与财务对接（FR-20~FR-24 + BRULE-4/6/9）
[ ] T28 缴费触发：校外审批通过后生成缴费单号/订单（FR-20）
[ ] T29 财务系统对接适配器：查询/接收缴费确认（成功/失败/待确认）（FR-21）
[ ] T30 财务对接 Mock：提供回调或轮询接口，保证可演示（IR-EXT-1）
[ ] T31 盖章凭证支持（可选但保留入口）：上传/关联凭证或在申请单标注缴费信息（FR-22）
[ ] T32 管理员最终确认：缴费确认成功后才能最终确认→状态“已生效/可借出”（FR-23）
[ ] T33 退款处理：撤销付费预约自动算95%退款并生成退款记录（FR-24 + BRULE-6）

九、借出/归还与状态联动（FR-25~FR-27）
[ ] T34 借出登记：基于已生效预约登记借出时间与交接信息（FR-25）
[ ] T35 归还登记：归还时间 + 设备状态（正常/损坏/待检修）（FR-26）
[ ] T36 状态更新：预约/借出/归还/检修驱动设备状态自动更新（FR-27）

十、导师维护学生名单（含Excel导入）（FR-28~FR-30）
[ ] T37 学生名单维护：教师新增/删除/查询指导学生（FR-28）
[ ] T38 Excel批量导入：模板下载 + 上传解析 + 格式校验 + 导入结果提示（FR-29）
[ ] T39 关系校验支撑：学生预约时管理员可核验导师-学生关系有效（FR-30）

十一、统计报表（周报/月报/年报）（FR-31~FR-33 + BRULE-8）
[ ] T40 报表统计逻辑：周/月/年报生成（FR-31）
[ ] T41 定时任务：按周期自动生成 + 手动补生成（FR-32 + IR-EXT-3）
[ ] T42 报表查询：负责人/管理员可查历史报表（FR-33）
[ ] T43 报表导出：PDF/Excel/CSV 任一实现 + 打印入口（FR-33）

十二、单据打印/导出（FR-34 + IR-EXT-2）
[ ] T44 单据导出打印：申请单/审批单/交接单（FR-34）
[ ] T45 打印兼容实现：统一用“导出PDF/浏览器打印”策略（NFR-9）

十三、通知提醒（FR-35）
[ ] T46 通知中心：站内通知（列表/已读）（FR-35）
[ ] T47 触发点覆盖：提交申请、审批结果、缴费确认、撤销/退款、报表生成、超期提醒（FR-35）

十四、访问限制（局域网）与审计（NFR-5/6）
[ ] T48 工作人员端“局域网限制”：对负责人/管理员接口做来源限制（IP白名单/反代限制/配置化）（NFR-6）
[ ] T49 可审计性：关键操作写 audit log（申请/审批/缴费确认/最终确认/借还/退款）（NFR-5）

十六、可靠性与交付（NFR-4/8）
[ ] T55 平台兼容：服务端Linux和windows可运行；PC端浏览器可用（NFR-8）
[ ] T56 部署：Docker Compose 或一键启动脚本（backend+frontend+db）
[ ] T57 演示数据：初始化三类用户、设备、预约样例，确保三条主流程可跑通
[ ] T58 自动化测试：业务规则单测 + 三条端到端流程集成测试
[ ] T59 最终自检：逐条对照FR-1~FR-35、NFR、BRULE覆盖情况，输出“覆盖矩阵”文档
